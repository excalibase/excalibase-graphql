server:
  port: 10000
  tomcat:
    threads:
      max: 200  # Limit max threads (virtual threads handle concurrency)
      min-spare: 10
    max-connections: 10000
    accept-count: 100
    connection-timeout: 20000
spring:
  application:
    name: Excalibase graphql
  threads:
    virtual:
      enabled: true
  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://localhost:5432/hana
    username: hana001
    password: password123
    hikari:
      maximum-pool-size: 50  # Limit connection pool
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
  jackson:
    default-property-inclusion: non_null  # Reduce JSON serialization overhead
  jmx:
    enabled: false  # Disable JMX to save memory

# Actuator optimization - expose only essential endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    enable:
      jvm: true
      process: true
      system: true
    distribution:
      percentiles-histogram:
        http.server.requests: false  # Disable histogram to save memory

app:
  allowed-schema: hana
  database-type: postgres
  cache:
    schema-ttl-minutes: 30  # Schema cache TTL in minutes (default: 30 minutes)
    role-privileges-ttl-minutes: 30  # Role privileges cache TTL in minutes (default: 30 minutes)
    graphql-ttl-minutes: 30  # GraphQL cache TTL in minutes (default: 30 minutes)
  security:
    role-based-schema: true  # Enable role-based schema filtering and RLS/CLS support (default: true)
  cdc:
    enabled: true  # Enable CDC (Change Data Capture) for real-time subscriptions (default: true)
    slot-name: cdc_slot  # Replication slot name (default: cdc_slot)
    publication-name: cdc_publication  # Publication name (default: cdc_publication)
    create-slot-if-not-exists: true  # Create replication slot if it doesn't exist (default: true)
    create-publication-if-not-exists: true  # Create publication if it doesn't exist (default: true)

# GraphQL Security Configuration - Production Defaults
# Based on GraphQL.org security recommendations and OWASP guidelines
graphql:
  security:
    max-query-depth: 20       # Prevent deeply nested queries (default: 20)
    max-query-complexity: 1000 # Prevent expensive operations (default: 1000)
    max-query-tokens: 5000    # Prevent parser DoS (default: 5000)
    max-query-characters: 50000 # 50KB query size limit (default: 50KB)
    max-whitespace-tokens: 10000
    max-rule-depth: 50
logging:
  level:
    root: ${log.level.root:info}
    org:
      springframework: ${log.level.spring:info}
    io:
      github:
        excalibase: ${log.level.app:info}
  pattern:
    console: "%d{ISO8601} %highlight(%-5level) [%blue(%t)] [%blue(%X{remoteAddr})] %yellow(%C{1}): %msg%n%throwable"